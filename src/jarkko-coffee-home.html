<link href="../bower_components/paper-button/paper-button.html" rel="import">
<link href="../bower_components/paper-input/paper-input.html" rel="import">
<link href="../bower_components/iron-form/iron-form.html" rel="import">
<link href="../bower_components/iron-ajax/iron-ajax.html" rel="import">
<link href="../bower_components/iron-autogrow-textarea/iron-autogrow-textarea.html" rel="import">

<dom-module id="jarkko-coffee-home">

	<template>
		<style>
		:host {
			display: block;
		}
		paper-button{
			display: block;
			color:white;
			margin:1em 0 0 0;
			background-color:#402501;
		}
		iron-autogrow-textarea{
			display: block;
	      	width:80%;
	      	background:#ffffff;
	      	padding:32px;
    		margin:0 auto;
    		margin-top:200px;
		}
		img{
			display: block;
			width:50%;
			height:10%;
			margin:0 auto;
		}
		</style>

		<paper-button raised id="btnLogout" style="float: right;">Salir</paper-button>

	</br>
		<iron-autogrow-textarea rows="10" placeholder="Chat" value="{{chattext}}">
		</iron-autogrow-textarea>

		<div>
		<paper-input value="{{message}}" style="width:80%; display:block; margin:0 auto;"></paper-input>
		<paper-button raised id="btnSend" style="width:20%; display:block; margin:0 auto;">Enviar</paper-button>
		</div>

		<iron-ajax 
			id="logoutRequest"
			method="DELETE"
			on-response="logoutResponse">
		</iron-ajax>

		<iron-ajax 
			id="sendRequest"
			url = "http://192.168.99.101:4005/Chat_ms/Api/Message";
			method="POST"
        	content-type="application/json"
			handle-as="json"
			on-response="sendResponse">
		</iron-ajax>
		
	</template>
	
	<script>
		Polymer({
			is: "jarkko-coffee-home",
			properties: {
				username: String,
				password: String,
				user:{
					type: Object,
					notify: false
				},
				session:{
					type: Object,
					notify: false
				},
				logout:{
					type: Object,
					notify: true
				}
			},
			ready: function(){
				this.$.btnLogout.addEventListener("click",()=> this.evtLogout())
				this.$.btnSend.addEventListener("click",()=> this.evtSend())
			},
			evtLogout: function(){
				this.$.logoutRequest.url = "http://192.168.99.101:4000/authentication/resources/sessions/" + localStorage.getItem("userId");
				this.$.logoutRequest.generateRequest();
			},
			evtSend: function(){
				this.$.sendRequest.body = { "message":this.message, "userfrom":localStorage.getItem("userId"), "userto":2};
				this.$.sendRequest.generateRequest();
			},
			logoutResponse: function(data){
				this.user = null;
				this.session = null;
				this.logout = !this.logout;
			},
			sendResponse: function(data){
				this.chattext = this.chattext + "\n"+this.message;
				this.message = "";
			}
		})
	</script>
</dom-module>